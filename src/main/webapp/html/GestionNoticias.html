<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Noticias</title>
    <link rel="stylesheet" href="../css/GestionNoticias.css">
    <script>
        // Validar permiso antes de que cargue la página
        window.onload = function () {
            const tienePermiso = sessionStorage.getItem("permisoRegistro") === "true";

            // Oculta el botón si no tiene permiso
            if (!tienePermiso) {
                const gestionUsuariosBtn = document.getElementById("btn-usuarios");
                if (gestionUsuariosBtn) {
                    gestionUsuariosBtn.style.display = "none";
                }
            }
        };
    </script>
</head>
    <body>
        <div class="pantalla">
            <!-- Barra lateral -->
            <div class="sidebar">
                <div class="logo-container">
                    <img src="../img/LogoOficial.png" alt="Logo UABC" class="logo">
                </div>

                <div class="menu-item" onclick="location.href='MenuPrincipal.jsp'">
                    <div class="circle-icon">
                        <img src="../img/MenuPrincipal.png" class="icono-lateral" alt="Menú Principal">
                    </div>
                    <div class="text">Menú Principal</div>
                </div>

                <div class="menu-item" id="btn-usuarios" onclick="location.href='GestionUsuarios.html'">
                    <div class="circle-icon">
                        <img src="../img/usuario.png" class="icono-lateral" alt="Gestión de Usuarios">
                    </div>
                    <div class="text">Gestión de Usuarios</div>
                </div>
            </div>

            <!-- Principal -->
            <div class="contenido">
                <h1 class="titulo">Bienvenido a la gestión de Noticias</h1>

                <!-- Íconos alineados a la derecha -->
                <div class="barra-iconos">
                    <button title="Modificar"><img src="../img/Modificar.png" alt="Modificar"></button>
                    <button title="Eliminar"><img src="../img/Eliminar.png" alt="Eliminar"></button>
                    <button title="Ordenar"><img src="../img/Ordenar.png" alt="Ordenar"></button>
                    <button title="Buscar"><img src="../img/Busqueda.png" alt="Buscar"></button>
                </div>

                <h2>Noticias Registradas</h2>
                <table id="tablaNoticias" border="1">
                    <thead>
                    <tr>
                        <th>No.</th>
                        <th>Título</th>
                        <th>Contenido</th>
                        <th>Fecha</th>
                        <th>Autor</th>
                        <th>Categoría</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Las noticias se cargarán aquí dinámicamente -->
                    </tbody>
                </table>

                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        fetch("../obtenerNoticias") // Ajusta la ruta si es necesario
                            .then(response => {
                                if (!response.ok) throw new Error("Error al obtener noticias");
                                return response.json();
                            })
                            .then(data => {
                                const tbody = document.querySelector("#tablaNoticias tbody");
                                tbody.innerHTML = ""; // Limpiar contenido previo

                                data.forEach((noticia, index) => {
                                    const fila = document.createElement("tr");
                                    fila.innerHTML = `
                                    <td>${index + 1}</td>
                                    <td>${noticia.titulo}</td>
                                    <td>${noticia.contenido}</td>
                                    <td>${noticia.fecha}</td>
                                    <td>${noticia.autor}</td>
                                    <td>${noticia.categoria}</td>
                                `;
                                    tbody.appendChild(fila);
                                });
                            })
                            .catch(error => {
                                console.error("No se pudieron cargar las noticias:", error);
                                alert("❌ Ocurrió un error al cargar las noticias.");
                            });
                    });
                </script>

                <!-- Botones -->
                <div class="botones">
                    <button class="publicar">Publicar Noticia</button>
                    <button class="crear" onclick="location.href='RegistroNoticias.html'">Crear Noticia</button>
                </div>
            </div>

            <!-- Ayuda -->
            <div class="ayuda" onclick="location.href='Ayuda.html'">
                <img src="../img/ayuda.png" alt="Ayuda">
                <span>Ayuda</span>
            </div>
        </div>
    </body>
</html>