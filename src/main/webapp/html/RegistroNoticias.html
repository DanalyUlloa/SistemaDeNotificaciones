<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Registro Noticia</title>
    <link rel="stylesheet" href="../css/FormularioNoticia.css" />
</head>
<body>
<div class="fondo">
    <!-- Bot√≥n volver -->
    <div class="volver">
        <button onclick="location.href='GestionNoticias.html'" class="btn-volver">
            <img src="../img/Regresar.png" alt="Volver" />
        </button>
    </div>

    <!-- Contenido -->
    <div class="contenido">
        <h1 class="titulo">Registrar Noticia</h1>
        <div class="form-container">
            <form id="formNoticia" action="/SistemaDeNotificaciones/registrarNoticia" method="POST" onsubmit="return confirmarRegistro(event)">
                <div class="form-group">
                    <label for="titulo">T√≠tulo:</label>
                    <input type="text" id="titulo" name="titulo" required />
                </div>
                <div class="form-group">
                    <label for="autor">Autor:</label>
                    <input type="text" id="autor" name="autor" required readonly />
                </div>
                <div class="form-group">
                    <label for="contenido">Contenido:</label>
                    <textarea id="contenido" name="contenido" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="fecha">Fecha (l√≠mite de publicaci√≥n):</label>
                    <input type="date" id="fecha" name="fecha" required />
                </div>
                <div class="form-group">
                    <label for="categoria">Categor√≠a:</label>
                    <select id="categoria" name="categoria" required>
                        <option value="">-- Selecciona una categor√≠a --</option>
                        <option value="1">Avisos Generales</option>
                        <option value="2">Eventos Acad√©micos</option>
                        <option value="3">Actividades Deportivas</option>
                        <option value="4">Comunicados Oficiales</option>
                    </select>
                </div>
                <button type="submit">Registrar</button>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Confirmaci√≥n -->
<div id="popupConfirmacion" class="popup">
    <div class="popup-contenido">
        <p class="popup-titulo">¬øDesea confirmar el registro?</p>
        <div class="popup-botones">
            <button class="btn-aceptar" onclick="confirmarEnvio()">Aceptar</button>
            <button class="btn-cancelar" onclick="cerrarPopup()">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de √âxito -->
<div id="popupExito" class="popup">
    <div class="popup-contenido">
        <p class="popup-titulo">‚úÖ Registro con √©xito</p>
        <button class="btn-cerrar" onclick="cerrarPopupExito()">‚úñ</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Establecer fecha m√≠nima para hoy
        const fechaInput = document.getElementById("fecha");
        const hoy = new Date().toISOString().split("T")[0];
        fechaInput.min = hoy;

        // Cargar autor desde sessionStorage
        const autorInput = document.getElementById("autor");
        const numEmpleado = sessionStorage.getItem("numEmpleado");
        if (autorInput && numEmpleado) {
            autorInput.value = numEmpleado;
        } else {
            console.warn("‚ö†Ô∏è numEmpleado no est√° en sessionStorage. ¬øEl usuario inici√≥ sesi√≥n?");
        }

        // Mostrar popup de √©xito si se redirigi√≥ con ?exito=true
        const params = new URLSearchParams(window.location.search);
        if (params.get("exito") === "true") {
            document.getElementById("popupExito").style.display = "flex";
        }
    });

    function confirmarRegistro(event) {
        event.preventDefault(); // Evita env√≠o inmediato
        document.getElementById("popupConfirmacion").style.display = "flex";
        return false;
    }

    function cerrarPopup() {
        document.getElementById("popupConfirmacion").style.display = "none";
    }

    function confirmarEnvio() {
        cerrarPopup();
        const form = document.getElementById("formNoticia");
        form.setAttribute("action", "/SistemaDeNotificaciones/registrarNoticia");
        console.log("üü¢ Enviando a:", form.action);
        form.submit();
    }

    function cerrarPopupExito() {
        document.getElementById("popupExito").style.display = "none";
    }
</script>
</body>
</html>
